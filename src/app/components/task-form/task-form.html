<div class="task-form-overlay" *ngIf="uiService.isTaskModalOpen()" (click)="close()">
    <div class="task-form-container" (click)="$event.stopPropagation(); isStatusDropdownOpen = false">

        <!-- Header -->
        <div class="form-header">
            <div class="status-dropdown-container">
                <div class="status-badge" (click)="toggleStatusDropdown($event)">
                    <span class="status-dot"></span>
                    <span>
                        <ng-container [ngSwitch]="form.get('status')?.value">
                            <span *ngSwitchCase="'DONE'">Done</span>
                            <span *ngSwitchCase="'IN_PROGRESS'">In Progress</span>
                            <span *ngSwitchDefault>To Do</span>
                        </ng-container>
                    </span>
                    <lucide-icon [img]="ChevronDown" size="14"></lucide-icon>
                </div>

                <div class="status-menu" *ngIf="isStatusDropdownOpen">
                    <div class="status-item" (click)="setStatus('TO_DO')">
                        <span class="status-dot todo"></span>
                        <span>To Do</span>
                        <lucide-icon *ngIf="form.get('status')?.value === 'TO_DO'" [img]="CheckCircle" size="14"
                            class="check-icon"></lucide-icon>
                    </div>
                    <div class="status-item" (click)="setStatus('IN_PROGRESS')">
                        <span class="status-dot progress"></span>
                        <span>In Progress</span>
                        <lucide-icon *ngIf="form.get('status')?.value === 'IN_PROGRESS'" [img]="CheckCircle" size="14"
                            class="check-icon"></lucide-icon>
                    </div>
                    <div class="status-item" (click)="setStatus('DONE')">
                        <span class="status-dot done"></span>
                        <span>Done</span>
                        <lucide-icon *ngIf="form.get('status')?.value === 'DONE'" [img]="CheckCircle" size="14"
                            class="check-icon"></lucide-icon>
                    </div>
                </div>
            </div>

            <button class="btn-close" (click)="close()">
                <lucide-icon [img]="X"></lucide-icon>
            </button>
        </div>

        <!-- Body -->
        <form [formGroup]="form" (ngSubmit)="onSubmit()" class="form-body">

            <!-- Title Row -->
            <div class="title-group">
                <lucide-icon [img]="Circle" class="title-icon" size="24"></lucide-icon>
                <input type="text" formControlName="title" class="title-input" placeholder="Task Name"
                    autocomplete="off">
            </div>

            <!-- Description -->
            <div class="description-group">
                <span class="description-label">DESCRIPTION</span>
                <textarea formControlName="description" class="description-input"
                    placeholder="Add a more detailed description..."></textarea>

                <div class="meta-info" *ngIf="isEditing">
                    <span>Created on {{ uiService.editingTask()?.createdAt || 'Oct 24, 2023' }}</span>
                    <span>Last updated 2 hours ago</span>
                </div>
            </div>

        </form>

        <!-- Footer -->
        <div class="form-footer">
            <button type="button" class="btn-delete" *ngIf="isEditing" (click)="deleteTask()">
                <lucide-icon [img]="Trash2" size="18"></lucide-icon>
                <span>Delete</span>
            </button>
            <div class="spacer" *ngIf="!isEditing"></div> <!-- Spacer to push buttons right if no delete -->

            <div class="footer-right">
                <button type="button" class="btn-cancel" (click)="close()">Close</button>
                <button type="button" class="btn-save" (click)="onSubmit()">Save</button>
            </div>
        </div>

    </div>
</div>